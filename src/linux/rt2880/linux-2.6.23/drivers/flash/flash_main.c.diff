diff -urN SDK_3_1_0_0/RT288x_SDK/source/linux-2.6.21.x/drivers/flash/flash_main.c SDK_3_2_0_0/RT288x_SDK/source/linux-2.6.21.x//drivers/flash/flash_main.c
--- SDK_3_1_0_0/RT288x_SDK/source/linux-2.6.21.x/drivers/flash/flash_main.c	2008-08-06 05:27:41.000000000 +0200
+++ SDK_3_2_0_0/RT288x_SDK/source/linux-2.6.21.x//drivers/flash/flash_main.c	2008-10-24 08:20:14.000000000 +0200
@@ -770,7 +770,7 @@
     uint32_t sector_size;
     uint32_t sector_base;
     uint32_t sector_num;
-    static uint8_t buffer[FLASH_MAX_RW_SIZE];
+    uint8_t  *buffer;
     uint8_t  *src;
     uint8_t  *dst;
 
@@ -782,11 +782,12 @@
     }
 
     src=(uint8_t *)source;
-    dst=(uint8_t *)(logic2phy(destination));
+    dst=(uint8_t *)(logic2phy((uint32_t)destination));
 
     /* get covered sector range */
     first_sector = FlashSectNum((uint32_t)dst);
     last_sector =  FlashSectNum((uint32_t)dst+numBytes -1);
+    buffer=kmalloc(FLASH_MAX_RW_SIZE, GFP_KERNEL);
     
     for(sector_num=first_sector; sector_num<= last_sector; sector_num++ ) {
 
@@ -819,6 +820,8 @@
 #endif
 	
     }
+    
+    kfree(buffer);
     return 0;
 }
 
@@ -1075,7 +1078,7 @@
 	return -1;
     }
 
-    memcpy((char *)dst,(char *)(logic2phy(src)),count);
+    memcpy((char *)dst,(char *)(logic2phy((uint32_t)src)),count);
     
     return 0;
 }
